== ACME Music Player - Architecture Playground

image::.github/badges/jacoco.svg[Line Coverage]
image::.github/badges/branches.svg[Branch Coverage]

== Was ist das hier? ğŸ§ª

Eine **Spielwiese fÃ¼r Architektur-Experimente** - ein minimal lauffÃ¤higer Prototyp eines Musikplayers, der als Testbed fÃ¼r moderne Software-Architektur-Patterns dient.

*Warum ein Musikplayer?* Weil er genug fachliche KomplexitÃ¤t bietet, um realistische Architektur-Entscheidungen zu treffen, aber einfach genug bleibt, um sich auf die technischen Aspekte zu konzentrieren.

**Experimenteller Rahmen:**
* Minimal lauffÃ¤higer Prototyp mit etwas FunktionalitÃ¤t
* Modulith mit 3 Komponenten (Users, Musicplayer, Scoreboard)
* Labor fÃ¼r Architektur-Patterns und Testing-Strategien
* Dokumentation von Erkenntnissen und gescheiterten AnsÃ¤tzen

== Evaluierte Architektur-Patterns âœ…

=== Erfolgreich implementiert & validiert:

* **ğŸ—ï¸ Modulith-Architektur** - Monolithische Anwendung mit klaren Modul-Grenzen
* **ğŸ”„ Event-Driven Design** - Lose gekoppelte Kommunikation zwischen Komponenten
* **ğŸ§ª Clean Architecture** - Klare Trennung von Domain, Use Cases und Adaptern
* **âš¡ Paralleles Testing** - Tenant-basierte Isolation fÃ¼r schnelle, unabhÃ¤ngige Tests
* **ğŸ¥’ Cucumber Component-Tests** - BDD-Tests mit Fake Adapters statt klassischer Unit-Tests
* **ğŸ“Š JOOQ-basierte Persistierung** - Type-safe SQL ohne JPA/Hibernate
* **ğŸŒ HTMX + SSE Frontend** - Moderne Web-UI ohne JavaScript-Framework

=== Verworfene AnsÃ¤tze (mit Learnings):

* **âŒ Spring Native** - Zu unreif, siehe xref:documentation/ADRs/01-spring-native.adoc[ADR Spring Native]



=== Features

â“ = Geplant | âŒ = Verworfen | âœ… = Implementiert

* **3 Module/Komponenten in einem Modulithen** âœ…
** **Users:** Registrierung und Fake-Login
** **Musicplayer:** MP3 hochladen, auflisten, abspielen
** **Scoreboard:** Auszeichnung fÃ¼r aktivste Nutzer
* **Cucumber-basierte** xref:documentation/componenttesting.adoc[Komponententests] âœ…
* **Datenbankmigration mit Liquibase** âœ…
* **Java Modell-Generierung mittels JOOQ** âœ…
* **Maximal parallele, unabhÃ¤ngige Tests** âœ…
* **Event Driven Architecture** âœ…
* **HTMX Frontend mit SSE** âœ…

== Schnellstart

[source,bash]
--
# Voraussetzungen: Java 21, Docker
sdk install java 21.0.2-tem && sdk use java 21.0.2-tem

# Datenbank aufsetzen und Tests laufen lassen
./mvnw clean test

# Anwendung starten
./mvnw docker-compose:up@run-docker
./mvnw spring-boot:run
--

AusfÃ¼hrliche Anleitung: xref:documentation/quickstart.adoc[â†’ Quickstart Guide]

== Laufende Experimente & Erkenntnisse

=== âœ… Abgeschlossene Experimente

==== Paralleles Testing durch Tenant-Isolation
**Status:** Erfolgreich implementiert

**Problem:** Langsame, sequentielle Integrationstests durch Datenbankreinigung
**LÃ¶sung:** Tenant-Parameter in allen Use Cases und Repositories
**Ergebnis:** Alle Tests kÃ¶nnen parallel in eigenen "Tenants" arbeiten

.Implementierung:
. UUID am Szenarioanfang im Test
. Alle Use Case Commands um "Tenant" Parameter erweitern (Default "1" oder "GLOBAL")
. Repos/Indizes nach Tenant-Id umbauen
. AfterAll: LÃ¶schen aller Testdaten anhand des Tenants

==== Modulith-Architektur
**Status:** Erfolgreich validiert

**Erkenntnisse:**
* Test-zu-Test Kommunikation via Fake Events funktioniert ausgezeichnet
* Klare Modul-Grenzen ohne Microservice-Overhead
* ArchUnit verhindert unerlaubte AbhÃ¤ngigkeiten zwischen Modulen

.Ãœberlegungen fÃ¼r Microservice-Migration:
* Use Case-RÃ¼ckgaben werden zu DTOs
* "Extra-Logik" findet automatisch bei DTO-Umwandlung statt
* Event-getriebene Kommunikation bleibt unverÃ¤ndert

=== â“ Laufende Experimente

==== Testdaten in komplexen Fachprozessen
**Problem:** Wie kÃ¶nnen Tests am Ende komplexer fachlicher Prozesse geschrieben werden?

**AnsÃ¤tze in Evaluation:**

. **Fachlich korrekte Testdatenbuilder**
   * âš ï¸ Gefahr der Re-Implementierung der Businesslogik im Testcode
   * âœ… Wiederverwendung von Businesslogik mÃ¶glich
   * âŒ Erzwingt Datenbankzugriff an Use Cases vorbei

. **Snapshot/Backup-Restore fÃ¼r Szenarien**
   * âœ… Szenario 1 laufen lassen â†’ snapshotted â†’ in Szenario 2 wiederverwenden
   * âŒ AbhÃ¤ngigkeiten zwischen Szenarien entstehen

. **Prozessorientierte Testszenarien**
   * Statt einzelner Features: komplette User-Journeys testen
   * Beispiel: "User registriert sich â†’ lÃ¤dt MP3 hoch â†’ spielt ab" in einem Szenario

==== Ideen fÃ¼r zukÃ¼nftige Experimente
* **Commands Pattern** â“
* **Event-Bibliothek mit Inbox/Outbox Pattern** â“
* **Automatische Event-Dokumentation** â“
* **Prozess-Visualisierung** â“

== Architektur & Design

=== System-Ãœberblick
image::acme-aufbau.drawio.png[ACME Systemaufbau,100%]

=== Test-Strategie Innovation
**Besonderheit:** ACME hat keine klassischen Unit-Tests, sondern ausschlieÃŸlich **Komponententests** mit sehr hoher Testabdeckung!

Detaillierte ErklÃ¤rung: xref:documentation/componenttesting.adoc[â†’ Component Testing Konzept]

=== Technologie-Stack

**Backend:**

* Java 21  
* Spring Boot 3.x
* JOOQ (statt JPA/Hibernate)
* PostgreSQL
* Liquibase

**Testing:**

* Cucumber (Component Tests)
* JUnit 5 (Integration Tests)
* Playwright (E2E Tests)

**Frontend:**

* HTMX
* Halfmoon CSS
* Server Sent Events (SSE)

**Infrastructure:**

* Docker & Docker Compose
* Maven Multi-Module

== Weitere Dokumentation

=== Architektur & Entscheidungen
* xref:documentation/ADRs/adrs.adoc[ğŸ“‹ Architecture Decision Records (ADRs)]
* xref:documentation/componenttesting.adoc[ğŸ§ª Component Testing Strategie]
* xref:documentation/quickstart.adoc[ğŸš€ Quickstart & Setup Guide]

=== Erkenntnisse aus Experimenten
* xref:documentation/ADRs/01-spring-native.adoc[Spring Native Evaluation] - Warum wir es verworfen haben
* xref:documentation/ADRs/02-testing-framework.adoc[Testing Framework Vergleich] - Cucumber vs. JUnit vs. Spock
* xref:documentation/ADRs/03-persistenzframework.adoc[Persistenz-Framework Entscheidung] - JOOQ vs. JPA

---

ğŸ’¡ **FÃ¼r Entwickler:** Dieses Projekt ist bewusst als Experimentierfeld konzipiert. Erkenntnisse, gescheiterte AnsÃ¤tze und Learnings sind genauso wertvoll wie funktionierende LÃ¶sungen!
